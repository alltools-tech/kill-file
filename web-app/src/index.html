<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Kill File – Universal Files Converter & Compressor</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link href="style.css" rel="stylesheet">
  <style>
    /* … your previous styles preserved … */
    body { background: linear-gradient(135deg, #f3f7fa 0%, #e9ebf7 100%); }
    /* Main titles, cards, drag-drop zones, sliders, modals … keep previous CSS */
  </style>
</head>
<body>
<div class="container py-2">
  <div class="text-center">
    <div class="main-title mt-2 mb-0">Kill File</div>
    <div class="subtitle-card mb-3">Universal Files Converter & Compressor</div>
  </div>

  <div class="row g-4">
    <!-- PDF to PDF/OCR -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header" style="background: linear-gradient(90deg,#d7e5fa 60%, #a9e9ff 100%); color: #23296b;">
          <i class="bi bi-file-earmark-pdf-fill"></i> PDF to PDF / OCR
        </div>
        <div class="card-body">
          <div class="drag-card">
            <div id="pdf2pdfDrop" class="drop-zone mb-2">
              Drag & drop PDF files here<br>
              <span>or <label for="pdf2pdfInput">browse</label></span>
              <input type="file" id="pdf2pdfInput" multiple accept=".pdf" style="display:none;">
            </div>
          </div>
          <div class="file-list" id="pdf2pdfList"></div>
          <div class="compress-bar mb-2">
            <label for="pdf2pdfQuality" class="form-label mb-0">Compression</label>
            <input type="range" id="pdf2pdfQuality" min="10" max="100" value="80">
            <span id="pdf2pdfQualityVal">80%</span>
          </div>
          <div class="mb-3">
            <label for="pdf2pdfLang" class="form-label">OCR Language</label>
            <select id="pdf2pdfLang" class="form-select">
              <option value="none">No OCR</option>
              <option value="eng">English</option>
              <option value="hin">Hindi</option>
              <option value="urd">Urdu</option>
              <option value="chi">Chinese</option>
              <option value="jpn">Japanese</option>
              <option value="ara">Arabic</option>
              <option value="rus">Russian</option>
              <option value="fra">French</option>
            </select>
          </div>
          <button type="button" class="btn btn-primary btn-convert w-100" id="pdf2pdfBtn">Convert & Compress</button>
          <div class="spinner-border text-primary" role="status" id="pdf2pdfSpin" style="display:none;"></div>
          <div class="output-area mt-2" id="pdf2pdfOutput"></div>
        </div>
      </div>
    </div>

    <!-- PDF to Image -->
    <!-- … copy similar structure for other sections (pdf2img, img2pdf, img2img, office2pdf) … -->
  </div>

  <!-- Preview Modal -->
  <div class="modal fade preview-modal" id="previewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">File Preview</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="previewContent"></div>
      </div>
    </div>
  </div>

  <div class="footer text-center mt-3 mb-2">
    <span class="text-muted">© 2025 Kill File · Free & Open Source · International OCR · ZIP Bulk Download</span>
  </div>
</div>

<script>
const API_BASE = "https://kill-file-2.onrender.com"; // Updated backend

// Utility
function formatSize(bytes) {
  if (bytes < 1024) return bytes + ' B';
  if (bytes < 1024*1024) return (bytes/1024).toFixed(1)+' KB';
  return (bytes/1024/1024).toFixed(2)+' MB';
}
function getExt(name){ return name.split('.').pop().toLowerCase(); }

// File upload handler
function setupFileSection(section) {
  const drop = document.getElementById(section+'Drop');
  const input = document.getElementById(section+'Input');
  const list = document.getElementById(section+'List');
  let files = [];
  drop.addEventListener('click', ()=>input.click());
  drop.addEventListener('dragover', e=>{ e.preventDefault(); drop.classList.add('dragover'); });
  drop.addEventListener('dragleave', ()=>drop.classList.remove('dragover'));
  drop.addEventListener('drop', e=>{ e.preventDefault(); drop.classList.remove('dragover'); handleFiles(e.dataTransfer.files); });
  input.addEventListener('change', ()=>{ if(input.files.length) handleFiles(input.files); });

  function handleFiles(flist){
    files = Array.from(flist);
    list.innerHTML = files.map(f=>`<span class="file-pill"><i class="bi bi-file-earmark"></i> ${f.name} <span class="badge bg-light text-dark">${getExt(f.name)}</span> <span class="badge bg-info text-dark">${formatSize(f.size)}</span></span>`).join('');
  }
  return ()=>files;
}

// Initialize sections
const getPdf2pdfFiles = setupFileSection('pdf2pdf');
// … repeat for pdf2img, img2pdf, img2img, office2pdf …

// Slider sync
function setupSlider(sliderId, valId) {
  const s = document.getElementById(sliderId), v = document.getElementById(valId);
  s.addEventListener('input', ()=>v.textContent=s.value+'%');
}
setupSlider('pdf2pdfQuality','pdf2pdfQualityVal');
// … repeat for other sliders …

// Show preview
function showPreviewLink(url,name){
  const ext = getExt(name);
  let html = '';
  if(['jpg','jpeg','png','bmp','svg','webp','avif','heic','heif'].includes(ext))
    html = `<img src="${url}" class="preview-image mb-2"><div>${name}</div>`;
  else if(ext==='pdf')
    html = `<iframe src="${url}" class="preview-pdf"></iframe><div>${name}</div>`;
  else
    html = `<div>No preview for ${ext.toUpperCase()}</div>`;
  document.getElementById('previewContent').innerHTML = html;
  new bootstrap.Modal(document.getElementById('previewModal')).show();
}

// API helpers
async function uploadAndConvert(endpoint, files, formFields={}){
  const fd = new FormData();
  files.forEach(f=>fd.append('files',f));
  Object.entries(formFields).forEach(([k,v])=>fd.append(k,v));
  const res = await fetch(endpoint,{method:'POST',body:fd});
  if(!res.ok) throw new Error(await res.text());
  return await res.json();
}
async function uploadAndConvertZip(endpoint, files, type, compress){
  const fd = new FormData();
  files.forEach(f=>fd.append('files',f));
  fd.append('type',type);
  fd.append('compress',compress);
  const res = await fetch(endpoint,{method:'POST',body:fd});
  if(!res.ok) throw new Error(await res.text());
  return await res.blob();
}

// Example: PDF to PDF
document.getElementById('pdf2pdfBtn').addEventListener('click', async()=>{
  const files = getPdf2pdfFiles();
  const compress = document.getElementById('pdf2pdfQuality').value;
  const ocrLang = document.getElementById('pdf2pdfLang').value;
  const spin = document.getElementById('pdf2pdfSpin');
  if(!files.length){ alert('Select files'); return; }
  spin.style.display='inline-block';
  try{
    const res = await uploadAndConvert(API_BASE+'/convert/pdf',files,{compress,ocr_lang:ocrLang});
    spin.style.display='none';
    document.getElementById('pdf2pdfOutput').innerHTML = res.results.map(r=>`
      <span class="file-pill output-pill">
        ${r.filename} <span class="badge bg-success text-dark">${Math.round(r.compressed_size/1024)} KB</span>
        <a href="${r.download_url}" class="btn btn-outline-success btn-sm btn-download" target="_blank">Download</a>
        <button class="btn btn-outline-primary btn-sm btn-preview" onclick="showPreviewLink('${r.download_url}','${r.filename}')">Preview</button>
      </span>
    `).join('');
  }catch(e){ spin.style.display='none'; alert('API Error: '+e.message); }
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>